<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Napredni Normiranec 2025</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        h1 { text-align: center; margin: 0 0 0.5rem 0; color: var(--text); }
        .subtitle { text-align: center; color: var(--text-light); font-size: 0.9rem; margin-bottom: 2rem; }

        /* Grid Layout for Inputs */
        .grid-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        @media (max-width: 600px) {
            .grid-inputs { grid-template-columns: 1fr; }
        }

        .input-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.4rem; font-weight: 600; font-size: 0.9rem; }
        
        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.2s;
            box-sizing: border-box;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary); ring: 2px solid var(--primary); }

        /* Toggles */
        .toggle-container {
            display: flex;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }
        .toggle-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-light);
            transition: all 0.2s;
        }
        .toggle-btn.active {
            background-color: white;
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Sections */
        .section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-light);
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.2rem;
        }

        /* Results */
        .results-box {
            background-color: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
        }
        .row.sub { padding-left: 1rem; font-size: 0.85rem; color: var(--text-light); }
        .row.total {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .val { font-family: 'Courier New', monospace; font-weight: 600; }
        .text-danger { color: var(--danger); }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }

        /* Tooltip / Info */
        .info-badge {
            background: #dbeafe;
            color: #1e40af;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
            font-weight: normal;
        }
        
        .calc-note {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 1rem;
            text-align: center;
            font-style: italic;
        }

        .breakdown-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.8rem;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
            margin-top: 5px;
        }
        
        #contrib-breakdown {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px dashed var(--border);
        }

    </style>
</head>
<body>

<div class="container">
    <h1>Normiranec 2025 Pro</h1>
    <div class="subtitle">Vključuje nove dohodninske razrede in avtomatski izračun prispevkov</div>

    <!-- Type Selector -->
    <div class="toggle-container">
        <div class="toggle-btn active" onclick="setMode('polni')" id="btn-polni">Polni S.P.</div>
        <div class="toggle-btn" onclick="setMode('popoldanski')" id="btn-popoldanski">Popoldanski</div>
    </div>

    <div class="grid-inputs">
        <div class="input-group">
            <label>Letni prihodki (€)</label>
            <input type="number" id="revenue" value="65000" oninput="calculate()">
            <small style="color:var(--text-light); font-size:0.75rem;">Vsa izdana in plačana sredstva</small>
        </div>
        
        <div class="input-group">
            <label>Povprečna bruto plača 2024/25 (€)</label>
            <input type="number" id="avg-salary" value="2450" oninput="calculate()">
            <small style="color:var(--text-light); font-size:0.75rem;">Osnova za prispevke (ocena 2025)</small>
        </div>
    </div>

    <!-- Polni SP Specific Settings -->
    <div id="polni-settings">
        <div class="section-title">Socialna Varnost (Prispevki)</div>
        <div class="grid-inputs">
            <div class="input-group">
                <label>Status zavarovanca <span class="info-badge">Popust na PIZ</span></label>
                <select id="newbie-status" onchange="calculate()">
                    <option value="regular">Redni zavezanec (brez popusta)</option>
                    <option value="year1">Prvi vpis (1. leto) - 50% PIZ</option>
                    <option value="year2">Prvi vpis (2. leto) - 30% PIZ</option>
                </select>
            </div>
            <div class="input-group">
                <label>Osnova za prispevke</label>
                <select id="base-method" onchange="calculate()">
                    <option value="current">Izračunaj glede na te prihodke (Steady state)</option>
                    <option value="min">Plačujem minimalne prispevke</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Results Area -->
    <div class="results-box">
        <!-- Tax Calculation -->
        <div class="row">
            <span>Priznani stroški</span>
            <span class="val" id="expenses">0.00 €</span>
        </div>
        <div class="row">
            <span>Davčna osnova (Dobiček)</span>
            <span class="val" id="tax-base">0.00 €</span>
        </div>
        <div class="row">
            <span>Dohodnina (20%)</span>
            <span class="val text-danger" id="tax">0.00 €</span>
        </div>

        <div style="border-bottom: 1px solid var(--border); margin: 10px 0;"></div>

        <!-- Contributions Calculation -->
        <div class="row">
            <span>Mesečni prispevki</span>
            <span class="val text-danger" id="monthly-contrib">0.00 €</span>
        </div>
        <div class="row sub">
            <span>Letni strošek prispevkov</span>
            <span class="val" id="annual-contrib">0.00 €</span>
        </div>

        <button class="breakdown-btn" onclick="toggleBreakdown()">Prikaži podrobnosti prispevkov</button>
        <div id="contrib-breakdown">
            <div class="row sub"><span>Osnova za prispevke:</span> <span class="val" id="insurance-base">0.00 €</span></div>
            <div class="row sub"><span>Pokojninsko (PIZ):</span> <span class="val" id="c-piz">0.00 €</span></div>
            <div class="row sub"><span>Zdravstveno (ZZ):</span> <span class="val" id="c-health">0.00 €</span></div>
            <div class="row sub"><span>Starševsko + Zaposlovanje:</span> <span class="val" id="c-other">0.00 €</span></div>
        </div>

        <!-- Totals -->
        <div class="row total">
            <span>Čisti dobiček (Neto)</span>
            <span class="val text-success" id="net">0.00 €</span>
        </div>
        <div class="row sub" style="justify-content: flex-end; margin-top: 5px;">
            <span>Efektivna obdavčitev (vse dajatve):&nbsp;</span>
            <span class="val" id="effective-rate">0%</span>
        </div>
    </div>
    
    <div class="calc-note">
        Izračun temelji na predlogu novele ZDoh-2 (nov 2025) in ocenjeni povprečni plači za leto 2025.
        <br>
        <span id="limit-warning" class="text-danger" style="display:none; font-weight:bold; margin-top:5px; display:block;">
            ⚠️ Pozor: Presegate limit 120.000 €.
        </span>
    </div>
</div>

<script>
    /**
     * SLOVENIA TAX CONFIGURATION (2025 Estimate)
     */
    const CONSTANTS = {
        // Contribution Rates (Sum of employee + employer parts for s.p.)
        rates: {
            piz: 0.1550 + 0.0885,      // 24.35%
            health: 0.0636 + 0.0656,   // 12.92%
            parental: 0.0010 + 0.0010, // 0.20%
            employ: 0.0014 + 0.0006    // 0.20%
        },
        // Popoldanski Fixed (Approx 2025 values)
        popoldanski: {
            piz: 46.00,    // Flat rate for PIZ
            health: 48.00, // Flat rate for ZZ
            limit: 50000
        },
        // Polni Limits
        polni: {
            limit: 120000,
            tier1_limit: 60000,
            tier1_exp: 0.80,
            tier2_exp: 0.00
        }
    };

    let currentMode = 'polni';

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('btn-polni').className = mode === 'polni' ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('btn-popoldanski').className = mode === 'popoldanski' ? 'toggle-btn active' : 'toggle-btn';
        
        // Toggle visibility of social security settings
        const settingsDiv = document.getElementById('polni-settings');
        settingsDiv.style.display = mode === 'polni' ? 'block' : 'none';
        
        calculate();
    }

    function toggleBreakdown() {
        const el = document.getElementById('contrib-breakdown');
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    function formatMoney(num) {
        return num.toLocaleString('sl-SI', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
    }

    function calculate() {
        const revenue = parseFloat(document.getElementById('revenue').value) || 0;
        const avgSalary = parseFloat(document.getElementById('avg-salary').value) || 2450;
        
        // --- 1. Calculate Tax Base (Dohodnina) ---
        let recognizedExpenses = 0;
        let limit = 0;

        if (currentMode === 'polni') {
            limit = CONSTANTS.polni.limit;
            
            // Tier 1: 0 to 60k
            const tier1Amount = Math.min(revenue, CONSTANTS.polni.tier1_limit);
            recognizedExpenses += tier1Amount * CONSTANTS.polni.tier1_exp;

            // Tier 2: 60k to 120k (0% expenses)
            // No calculation needed as rate is 0, but logic is here:
            // if (revenue > 60000) { ... * 0.0 }
            
        } else {
            // Popoldanski Logic (Nov 2025: 80% up to 12.5k, 40% up to 50k)
            limit = CONSTANTS.popoldanski.limit;
            
            const tier1Limit = 12500;
            const tier1Amount = Math.min(revenue, tier1Limit);
            recognizedExpenses += tier1Amount * 0.80;

            if (revenue > tier1Limit) {
                const tier2Amount = Math.min(revenue, 50000) - tier1Limit;
                recognizedExpenses += Math.max(0, tier2Amount * 0.40);
            }
        }

        const profit = Math.max(0, revenue - recognizedExpenses); // Davčna osnova
        const tax = profit * 0.20; // 20% Tax Rate

        // --- 2. Calculate Contributions (Prispevki) ---
        let monthlyContrib = 0;
        let breakdown = { piz: 0, health: 0, other: 0, base: 0 };

        if (currentMode === 'popoldanski') {
            // Flat rate
            breakdown.piz = CONSTANTS.popoldanski.piz;
            breakdown.health = CONSTANTS.popoldanski.health;
            monthlyContrib = breakdown.piz + breakdown.health;
        } else {
            // Polni S.P. Logic
            const minBase = 0.60 * avgSalary;
            const maxBase = 3.50 * avgSalary;
            
            // Determine Insurance Base
            let calculatedBase = 0;
            const method = document.getElementById('base-method').value;

            if (method === 'min') {
                calculatedBase = minBase;
            } else {
                // Formula: (Profit * 0.75) / 12
                // Note: The exact law says Base = (Dohodek - Odhodki) * 0.75. 
                // Usually based on PREVIOUS year. We assume Steady State here.
                calculatedBase = (profit * 0.75) / 12;
                
                // Clamp values
                if (calculatedBase < minBase) calculatedBase = minBase;
                if (calculatedBase > maxBase) calculatedBase = maxBase;
            }
            
            breakdown.base = calculatedBase;

            // Calculate Raw Components
            let rawPiz = calculatedBase * CONSTANTS.rates.piz;
            let rawHealth = calculatedBase * CONSTANTS.rates.health;
            let rawParental = calculatedBase * CONSTANTS.rates.parental;
            let rawEmploy = calculatedBase * CONSTANTS.rates.employ;

            // Apply "Newbie" Discounts (Only applies to PIZ part)
            const newbieStatus = document.getElementById('newbie-status').value;
            if (newbieStatus === 'year1') {
                // 50% discount on PIZ
                // Note: Discount applies to the PIZ contribution calculated from MIN base usually, 
                // but generally interpreted as 50% of the PIZ obligation.
                rawPiz = rawPiz * 0.5; 
            } else if (newbieStatus === 'year2') {
                // 30% discount on PIZ
                rawPiz = rawPiz * 0.7;
            }

            breakdown.piz = rawPiz;
            breakdown.health = rawHealth;
            breakdown.other = rawParental + rawEmploy;
            
            monthlyContrib = rawPiz + rawHealth + rawParental + rawEmploy;
        }

        const annualContrib = monthlyContrib * 12;
        const net = revenue - tax - annualContrib;
        const effectiveRate = revenue > 0 ? ((tax + annualContrib) / revenue * 100) : 0;

        // --- 3. Update DOM ---
        document.getElementById('expenses').innerText = formatMoney(recognizedExpenses);
        document.getElementById('tax-base').innerText = formatMoney(profit);
        document.getElementById('tax').innerText = formatMoney(tax);
        
        document.getElementById('monthly-contrib').innerText = formatMoney(monthlyContrib);
        document.getElementById('annual-contrib').innerText = formatMoney(annualContrib);
        
        // Breakdown
        document.getElementById('insurance-base').innerText = formatMoney(breakdown.base || 0);
        document.getElementById('c-piz').innerText = formatMoney(breakdown.piz);
        document.getElementById('c-health').innerText = formatMoney(breakdown.health);
        document.getElementById('c-other').innerText = formatMoney(breakdown.other || 0);

        document.getElementById('net').innerText = formatMoney(net);
        document.getElementById('effective-rate').innerText = effectiveRate.toFixed(1) + '%';

        // Warning
        const warning = document.getElementById('limit-warning');
        if (revenue > limit) {
            warning.style.display = 'block';
            warning.innerText = `⚠️ Pozor: Presegate limit za normiranstvo (${formatMoney(limit)}).`;
        } else {
            warning.style.display = 'none';
        }
    }

    // Init
    calculate();
</script>

</body>
</html>
