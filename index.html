<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slovenia Tax & Contributions 2025</title>
    <style>
        :root {
            --primary: #0f172a;
            --accent: #2563eb;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #334155;
            --border: #e2e8f0;
            --red: #ef4444;
            --green: #10b981;
        }

        [data-theme="dark"] {
            --primary: #f8fafc;
            --accent: #60a5fa;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #cbd5e1;
            --border: #334155;
            --red: #f87171;
            --green: #34d399;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .app { background: var(--card); width: 100%; max-width: 650px; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        h2 { margin: 0; color: var(--primary); }
        .tools button { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .tools button:hover { background: var(--border); }

        /* Toggles */
        .tabs { display: flex; background: var(--bg); padding: 5px; border-radius: 10px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-weight: 600; color: var(--text); border-radius: 8px; transition: 0.2s; opacity: 0.7; }
        .tab.active { background: var(--card); opacity: 1; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* Inputs */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); border-radius: 8px; box-sizing: border-box; outline: none; }
        .input-group input:focus { border-color: var(--accent); }

        /* Results */
        .results { background: var(--bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); }
        .line { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 0.95rem; }
        .line.sub { padding-left: 15px; font-size: 0.85rem; color: var(--text); opacity: 0.8; }
        .line.total { border-top: 2px solid var(--border); margin-top: 15px; padding-top: 15px; font-weight: 700; font-size: 1.2rem; }
        
        .val { font-family: 'Courier New', monospace; font-weight: 600; }
        .text-red { color: var(--red); }
        .text-green { color: var(--green); }
        
        .badge-new { background: #dbeafe; color: #1e40af; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        [data-theme="dark"] .badge-new { background: #172554; color: #bfdbfe; }
    </style>
</head>
<body>

<div class="app">
    <div class="header">
        <h2>Normiranec 2025</h2>
        <div class="tools">
            <button onclick="toggleLang()" id="btnLang">SL</button>
            <button onclick="toggleTheme()" id="btnTheme">üåó</button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="setMode('polni')" id="tab-polni">Polni S.P.</div>
        <div class="tab" onclick="setMode('pop')" id="tab-pop">Popoldanski</div>
    </div>

    <div class="grid">
        <div class="input-group">
            <label data-t="revenue">Letni prihodki (‚Ç¨)</label>
            <input type="number" id="revenue" value="65000" oninput="calc()">
        </div>
        <div class="input-group">
            <label data-t="salary">Bruto plaƒça 2024 (‚Ç¨)</label>
            <input type="number" id="avgSalary" value="2395" oninput="calc()">
        </div>
    </div>

    <div id="full-settings" class="grid">
        <div class="input-group">
            <label data-t="status">Status (Popust PIZ)</label>
            <select id="status" onchange="calc()">
                <option value="reg">Redni (Polni prispevki)</option>
                <option value="y1">1. leto (-50% PIZ)</option>
                <option value="y2">2. leto (-30% PIZ)</option>
            </select>
        </div>
        <div class="input-group">
            <label data-t="base">Osnova za prispevke</label>
            <select id="baseType" onchange="calc()">
                <option value="auto">Glede na dobiƒçek (Realno)</option>
                <option value="min">Minimalni prispevki</option>
            </select>
        </div>
    </div>

    <div class="results">
        <div class="line">
            <span data-t="exp">Priznani stro≈°ki</span>
            <span class="val" id="out-exp">0.00 ‚Ç¨</span>
        </div>
        <div class="line">
            <span data-t="taxbase">Davƒçna osnova</span>
            <span class="val" id="out-base">0.00 ‚Ç¨</span>
        </div>
        <div class="line">
            <span data-t="tax">Dohodnina (20%)</span>
            <span class="val text-red" id="out-tax">0.00 ‚Ç¨</span>
        </div>
        
        <div style="height:1px; background:var(--border); margin:15px 0;"></div>

        <div class="line">
            <span data-t="soc_total">Skupaj prispevki (Meseƒçno)</span>
            <span class="val text-red" id="out-soc-mo">0.00 ‚Ç¨</span>
        </div>

        <!-- Details -->
        <div class="line sub">
            <span>Osnova (Bruto):</span>
            <span class="val" id="out-ins-base">0.00 ‚Ç¨</span>
        </div>
        <div class="line sub">
            <span>Socialno (PIZ, ZZ, Star≈°):</span>
            <span class="val" id="out-soc-main">0.00 ‚Ç¨</span>
        </div>
        <div class="line sub">
            <span>Dolg. oskrba (2%) <span class="badge-new">NOVO</span>:</span>
            <span class="val" id="out-do">0.00 ‚Ç¨</span>
        </div>
        <div class="line sub" id="row-ozp">
            <span>OZP (Fiksni) <span class="badge-new">35‚Ç¨</span>:</span>
            <span class="val" id="out-ozp">35.00 ‚Ç¨</span>
        </div>

        <div class="line total">
            <span data-t="net">Neto (Letno)</span>
            <span class="val text-green" id="out-net">0.00 ‚Ç¨</span>
        </div>
    </div>
    
    <div id="msg-limit" style="display:none; color:var(--red); font-weight:bold; margin-top:15px; text-align:center;">
        ‚ö†Ô∏è Limit 120.000 ‚Ç¨ prese≈æen!
    </div>
</div>

<script>
    // Constants for 2025
    const C = {
        // Full S.P. Rates
        rates: {
            piz: 0.2435,      // 15.5% + 8.85%
            zz: 0.1292,       // 6.36% + 6.56%
            parent: 0.0020,   // 0.1% + 0.1%
            emp: 0.0020,      // 0.14% + 0.06%
            do: 0.0200        // 1.0% + 1.0% (Dolgotrajna Oskrba - New 2025)
        },
        ozp: 35.00, // Obvezni zdravstveni prispevek (Fixed)
        
        // Afternoon (Popoldanski) Fixed Estimations 2025
        pop: {
            piz: 49.15, 
            zz: 10.13,  // ZZ (po≈°kodbe pri delu) 
            zz_ozp: 0,  // Paid by employer
            do: 5.97,   // Estimated DO fixed amount
            total_zz_fixed: 46.00 // Standard fixed ZZ often cited around ~46‚Ç¨ total with piz
        },
        // Actual fixed Pav≈°al for Popoldanski (approximate values for 2025):
        // PIZ: ~49.15‚Ç¨
        // ZZ: ~10.13‚Ç¨ (Health - injury at work) + ~40.50‚Ç¨ (Health - broad)? 
        // NOTE: Popoldanski usually pays ~93‚Ç¨ total (2024). 
        // 2025 estimate: ~96‚Ç¨ + DO.
        pop_total_est: 105.00 
    };

    let state = { mode: 'polni', lang: 'sl' };

    const T = {
        sl: {
            revenue: "Letni prihodki (‚Ç¨)",
            salary: "Povpreƒçna bruto plaƒça 2024 (‚Ç¨)",
            status: "Status zavarovanca",
            base: "Osnova za prispevke",
            exp: "Priznani stro≈°ki",
            taxbase: "Davƒçna osnova",
            tax: "Dohodnina (20%)",
            soc_total: "Meseƒçni prispevki",
            net: "Neto dobiƒçek",
        },
        en: {
            revenue: "Annual Revenue (‚Ç¨)",
            salary: "Avg Gross Salary 2024 (‚Ç¨)",
            status: "Insured Status",
            base: "Contribution Base",
            exp: "Recognized Expenses",
            taxbase: "Tax Base",
            tax: "Income Tax (20%)",
            soc_total: "Monthly Contributions",
            net: "Net Profit",
        }
    };

    function init() {
        if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) toggleTheme();
        calc();
    }

    function toggleTheme() {
        const body = document.documentElement;
        body.setAttribute('data-theme', body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    function toggleLang() {
        state.lang = state.lang === 'sl' ? 'en' : 'sl';
        document.getElementById('btnLang').innerText = state.lang.toUpperCase();
        // Simple update
        for(let key in T[state.lang]) {
            const el = document.querySelector(`[data-t="${key}"]`);
            if(el) el.innerText = T[state.lang][key];
        }
    }

    function setMode(m) {
        state.mode = m;
        document.getElementById('tab-polni').className = m === 'polni' ? 'tab active' : 'tab';
        document.getElementById('tab-pop').className = m === 'pop' ? 'tab active' : 'tab';
        document.getElementById('full-settings').style.display = m === 'polni' ? 'grid' : 'none';
        
        // Hide OZP row for Popoldanski (paid by employer)
        document.getElementById('row-ozp').style.display = m === 'polni' ? 'flex' : 'none';
        
        calc();
    }

    function fmt(n) { return n.toLocaleString('sl-SI', {minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨'; }

    function calc() {
        const rev = parseFloat(document.getElementById('revenue').value) || 0;
        const avgSal = parseFloat(document.getElementById('avgSalary').value) || 2395; // PP 2024 estimate

        // 1. Expenses (Nov 2025 Rules)
        let expenses = 0;
        let limit = state.mode === 'polni' ? 120000 : 50000;

        if (state.mode === 'polni') {
            // 80% up to 60k, 0% from 60k-120k
            const t1 = Math.min(rev, 60000);
            expenses = t1 * 0.80;
        } else {
            // 80% up to 12.5k, 40% up to 50k
            const t1 = Math.min(rev, 12500);
            expenses += t1 * 0.80;
            if(rev > 12500) expenses += (Math.min(rev, 50000) - 12500) * 0.40;
        }

        const profit = Math.max(0, rev - expenses);
        const tax = profit * 0.20;

        // 2. Contributions
        let monthly = 0;
        let c_base = 0;
        let c_main = 0; // PIZ + ZZ + Par + Emp
        let c_do = 0;
        let c_ozp = 0;

        if (state.mode === 'pop') {
            // Fixed Pav≈°al 2025 Estimate
            // PIZ (~49) + ZZ (~50) + DO (~6)
            c_main = 49.15 + 50.63; // PIZ + ZZ
            c_do = 5.97;
            monthly = c_main + c_do; 
            // NO OZP for Popoldanski (Paid by employer)
        } else {
            // Polni: Complex Calculation
            c_ozp = C.ozp; // 35.00 Fixed

            const minBase = 0.60 * avgSal;
            const maxBase = 3.50 * avgSal;
            const rateSum = C.rates.piz + C.rates.zz + C.rates.parent + C.rates.emp + C.rates.do;

            if (document.getElementById('baseType').value === 'min') {
                c_base = minBase;
            } else {
                // Steady State Formula
                // Base = (Profit * 0.75) / (12 - 9 * RateSum)
                const denom = 12 - (9 * rateSum);
                if (denom > 0) c_base = (profit * 0.75) / denom;
                else c_base = maxBase;
                
                c_base = Math.min(Math.max(c_base, minBase), maxBase);
            }

            // Calc Components
            let rawPiz = c_base * C.rates.piz;
            const rawOther = c_base * (C.rates.zz + C.rates.parent + C.rates.emp);
            const rawDo = c_base * C.rates.do;

            // Apply PIZ Discount
            const st = document.getElementById('status').value;
            if (st === 'y1') rawPiz *= 0.5;
            if (st === 'y2') rawPiz *= 0.7;

            c_main = rawPiz + rawOther;
            c_do = rawDo;
            
            monthly = c_main + c_do + c_ozp;
        }

        const annualSoc = monthly * 12;
        const net = rev - tax - annualSoc;

        // Display
        document.getElementById('out-exp').innerText = fmt(expenses);
        document.getElementById('out-base').innerText = fmt(profit);
        document.getElementById('out-tax').innerText = fmt(tax);
        
        document.getElementById('out-soc-mo').innerText = fmt(monthly);
        document.getElementById('out-ins-base').innerText = fmt(c_base);
        document.getElementById('out-soc-main').innerText = fmt(c_main);
        document.getElementById('out-do').innerText = fmt(c_do);
        document.getElementById('out-ozp').innerText = fmt(c_ozp);
        
        document.getElementById('out-net').innerText = fmt(net);

        document.getElementById('msg-limit').style.display = rev > limit ? 'block' : 'none';
    }

    init();
</script>
</body>
</html>
